# 后端概述

在这个项目里后端是负责实现一个排行榜功能的，我们选择使用了Java语言，用其原生的tomcat服务与JDBC驱动来处理MySQL数据库中的数据。

# 数据库

数据库名称：waste-sort

结构：

```
+----------------------+
| Tables_in_waste-sort |
+----------------------+
| ranking              |
| wastedata            |
+----------------------+
```

## ranking 表

该表用于储存排行榜信息，有姓名和成绩两个字段。

结构：

```
+----------+--------------+------+-----+---------+-------+
| Field    | Type         | Null | Key | Default | Extra |
+----------+--------------+------+-----+---------+-------+
| username | varchar(255) | NO   | PRI | NULL    |       |
| score    | int          | NO   | PRI | NULL    |       |
+----------+--------------+------+-----+---------+-------+
```

## wastedata 表

该表用于储存垃圾字典，有 垃圾编号、垃圾名称、垃圾类型、垃圾宽度、垃圾高度 五个字节，这里的数据是预先写入的，供前端获取后渲染成设计好的垃圾单位。

结构：

```
+--------+--------------+------+-----+---------+----------------+
| Field  | Type         | Null | Key | Default | Extra          |
+--------+--------------+------+-----+---------+----------------+
| id     | int          | NO   | PRI | NULL    | auto_increment |
| name   | varchar(255) | NO   |     | NULL    |                |
| type   | varchar(255) | NO   |     | NULL    |                |
| width  | int          | NO   |     | NULL    |                |
| height | int          | NO   |     | NULL    |                |
+--------+--------------+------+-----+---------+----------------+
```

# 后端

## /update 接口

类型：POST

该接口用于在一局游戏结束后上传分数。

### 入参

| 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: |
| username | string | 玩家昵称 |
| score | string | 玩家分数 |

### 出参

| 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: |
| message | string | 状态码 |

#### message

`success`: 本次上传成功了。

`error`: 本次上传在数据库环节出错了。

## /getData 接口

类型：GET

该接口用于在查看排行榜时获取数据，调用后后端会返回最多10个当天排行榜上的玩家，按升序排列。

### 入参

无

### 出参

| 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: |
| message | string | 状态码 |
| data | array | 数据数组 |

#### message

`success`: 本次上传成功了。

`error`: 本次上传在数据库环节出错了。

#### data 数组中的结构

| 成员名 | 成员类型 | 备注 |
| :----: | :----: | :----: |
| username | string | 玩家昵称 |
| score | string | 玩家分数 |

## /getDict 接口

类型：GET

该接口用于获取垃圾字典中的垃圾数据

### 入参

无

### 出参

一个数组：

| 成员名 | 成员类型 | 备注 |
| :----: | :----: | :----: |
| name | string | 垃圾名称 |
| id | int | 垃圾编号 |
| type | int | 垃圾类型 |
| width | int | 垃圾宽度 |
| height | int | 垃圾高度 |

## /getChallenge 接口

类型：GET

该接口用于获取每日挑战内容，会返回随机的14个垃圾编号作为当天的挑战。

### 入参

无

### 出参

| 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: |
| message | string | 状态码 |
| data | array | 数据数组 |

#### message

`updated`: 无需更新字典。

`toUpdate`: 需要更新字典，客户端收到该状态消息会额外发送一条请求 getDict。

#### data 数组中的结构

| 成员名 | 成员类型 | 备注 |
| :----: | :----: | :----: |
| type | int | 垃圾编号 |